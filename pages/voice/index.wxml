<!-- pages/voice/index.wxml -->
<!-- èŒåœºå˜´æ›¿é¡µé¢ - å•å¡ç‰‡å±•ç¤ºè®¾è®¡ -->
<view class="voice-container">
  <!-- é¡¶éƒ¨å¯¼èˆªåŒºåŸŸ -->
  <view class="voice-header">
    <view class="filter-btn" bindtap="onFilterTap">
      <text>âš™ï¸</text>
    </view>
    <!-- ç§»é™¤é¡¶éƒ¨åˆ†äº«æŒ‰é’®ï¼Œé¿å…ä¸åº•éƒ¨å¼•å¯¼é‡å¤ -->
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å¡ç‰‡å†…å®¹åŒºåŸŸ -->
  <view wx:else class="card-container">
    <!-- å¯æ‹–æ‹½åŒºåŸŸ -->
    <movable-area class="card-area">
      <!-- æ»‘åŠ¨æŒ‡ç¤ºå™¨ -->
      <view class="swipe-indicator left {{swipeDirection === 'left' ? 'show' : ''}}">âœ•</view>
      <view class="swipe-indicator right {{swipeDirection === 'right' ? 'show' : ''}}">â¤ï¸</view>
      <!-- ç§»é™¤ä¸Šæ»‘æŒ‡ç¤ºå™¨ï¼Œç¦ç”¨ä¸Šæ»‘æ‰‹åŠ¿ç›¸å…³çš„è§†è§‰å¼•å¯¼ -->
      <view class="swipe-indicator up {{swipeDirection === 'up' ? 'show' : ''}}">â†—ï¸</view>
      
      <movable-view 
        class="card-view"
        direction="all"
        x="{{cardX}}"
        y="{{cardY}}"
        animation="{{cardAnimation}}"
        bindtouchstart="onCardTouchStart"
        catchtouchmove="onCardTouchMove"
        bindtouchend="onCardTouchEnd"
      >
        <!-- å½“å‰å¡ç‰‡ -->
        <view class="content-card {{contentAnimClass}}" style="transform: translate3d({{cardX}}px, {{cardY}}px, 0) rotate({{cardRotate}}deg) scale({{cardScale}}); opacity: {{cardOpacity}};">
          <!-- å¡ç‰‡ç±»å‹å›¾æ ‡ -->
          <view class="card-type-icon">
            <text wx:if="{{currentCard.type === 'quote'}}">ğŸ’¬</text>
            <text wx:else>ğŸ—³ï¸</text>
          </view>

          <!-- è¯­å½•å¡ç‰‡å†…å®¹ -->
          <view wx:if="{{currentCard.type === 'quote'}}" class="quote-card">
            <view class="quote-content">{{currentCard.content}}</view>
          </view>

          <!-- æŠ•ç¥¨å¡ç‰‡å†…å®¹ -->
          <view wx:else class="vote-card">
            <view class="vote-topic">{{currentCard.topic}}</view>
            
            <!-- æŠ•ç¥¨é€‰é¡¹ -->
            <view class="vote-options">
              <view 
                class="vote-option {{selectedOption === 'A' ? 'selected option-a' : ''}}"
                data-option="A"
                bindtap="onVoteOptionTap"
              >
                <text class="option-text">{{currentCard.optionA}}</text>
                <!-- æŠ•ç¥¨ç™¾åˆ†æ¯” -->
                <view class="vote-percentage option-a {{showVoteResult ? 'show' : ''}}">
                  <view class="percentage-bar">
                    <view class="percentage-progress option-a" style="width: {{voteResultA}}%"></view>
                  </view>
                  <view class="percentage-text option-a">{{voteResultA}}%</view>
                </view>
              </view>
              
              <view 
                class="vote-option {{selectedOption === 'B' ? 'selected option-b' : ''}}"
                data-option="B"
                bindtap="onVoteOptionTap"
              >
                <text class="option-text">{{currentCard.optionB}}</text>
                <!-- æŠ•ç¥¨ç™¾åˆ†æ¯” -->
                <view class="vote-percentage option-b {{showVoteResult ? 'show' : ''}}">
                  <view class="percentage-bar">
                    <view class="percentage-progress option-b" style="width: {{voteResultB}}%"></view>
                  </view>
                  <view class="percentage-text option-b">{{voteResultB}}%</view>
                </view>
              </view>
            </view>

          </view>

          <!-- ç‚¹èµåŒºåŸŸ -->
          <view class="like-section">
            <view class="like-count">
              <text class="like-icon">â¤ï¸</text>
              <text>{{currentCard.likeCount || 0}}</text>
            </view>
            <!-- ç‚¹èµåŠ¨ç”» -->
            <view wx:if="{{showLikeAnimation}}" class="like-animation">+1</view>
          </view>
        </view>
      </movable-view>
    </movable-area>
  </view>

  <!-- å¯¼èˆªæŒ‡ç¤ºåŒºåŸŸ -->
  <view wx:if="{{!isLoading}}" class="navigation-hints">
    <view class="hint-item">
      <view class="hint-icon">ğŸ‘ˆ</view>
      <text>å·¦æ»‘è·³è¿‡</text>
    </view>
    <view class="hint-item">
      <view class="hint-icon">ğŸ‘‰</view>
      <text>å³æ»‘ç‚¹èµ</text>
    </view>
    <!-- å°†â€œä¸Šæ»‘åˆ†äº«â€æ›¿æ¢ä¸ºâ€œç‚¹å‡»åˆ†äº«â€ï¼Œå¹¶ä½¿ç”¨ open-type="share" çš„æŒ‰é’® -->
    <button class="hint-item share-hint-btn" open-type="share">
      <view class="hint-icon">ğŸ—¨ï¸</view>
      <text>ç‚¹å‡»åˆ†äº«</text>
    </button>
  </view>

  <!-- ç­›é€‰å¼¹çª— -->
  <view wx:if="{{showFilterModal}}" class="filter-modal {{showFilterModal ? 'show' : ''}}" bindtap="onFilterModalClose">
    <view class="filter-content" catchtap="stopPropagation">
      <view class="filter-header">
        <view class="filter-title">å†…å®¹ç­›é€‰</view>
        <view class="filter-close" bindtap="onFilterModalClose">âœ•</view>
      </view>
      
      <!-- ç±»å‹ç­›é€‰ -->
      <view class="filter-section">
        <text class="section-title">å†…å®¹ç±»å‹</text>
        <view class="filter-types">
          <view 
            class="type-btn {{filterType === 'all' ? 'active' : ''}}"
            data-type="all"
            bindtap="onFilterTypeChange"
          >
            <text>å…¨éƒ¨</text>
          </view>
          <view 
            class="type-btn {{filterType === 'quote' ? 'active' : ''}}"
            data-type="quote"
            bindtap="onFilterTypeChange"
          >
            <text>è¯­å½•</text>
          </view>
          <view 
            class="type-btn {{filterType === 'vote' ? 'active' : ''}}"
            data-type="vote"
            bindtap="onFilterTypeChange"
          >
            <text>æŠ•ç¥¨</text>
          </view>
        </view>
      </view>
      
      <!-- æ ‡ç­¾ç­›é€‰ -->
      <view class="filter-section">
        <text class="section-title">çƒ­é—¨æ ‡ç­¾</text>
        <view class="filter-tags">
          <view 
            wx:for="{{popularTags}}"
            wx:key="*this"
            class="tag-btn {{selectedTags.indexOf(item) !== -1 ? 'active' : ''}}"
            data-tag="{{item}}"
            bindtap="onTagFilterToggle"
          >
            <text>{{item}}</text>
          </view>
        </view>
      </view>
      
      <view class="filter-actions">
        <view class="action-btn reset-btn" bindtap="onFilterReset">é‡ç½®</view>
        <view class="action-btn confirm-btn" bindtap="onFilterConfirm">ç¡®å®š</view>
      </view>
    </view>
  </view>
</view>
<view class="disabled-banner banner-mbti">
  <text class="icon">ğŸ§ </text>
  <text class="msg">èŒåœºMBTIåŠŸèƒ½å¼€å‘ä¸­ï¼Œè¯·æœŸå¾…</text>
</view>