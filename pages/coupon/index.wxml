<!-- pages/coupon/index.wxml -->
<view class="coupon-page">
  <!-- 顶部搜索入口（点击进入二级搜索页） -->
  <view class="search-bar" bindtap="navigateToSearch" hover-class="none" hover-stop-propagation="true">
    <image class="search-icon" src="/images/search.svg" mode="widthFix" />
    <text class="search-placeholder">搜商品/品牌</text>
  </view>
  <!-- 顶部合作品牌圆标 -->
  <scroll-view class="brand-scroll" scroll-x="true" enable-flex="true" show-scrollbar="false">
    <view class="brand-item" wx:for="{{partnerBrands}}" wx:key="name" data-name="{{item.name}}" data-logo="{{item.logo}}" bindtap="onPartnerBrandTap">
      <view class="brand-logo-wrap">
        <image class="brand-logo" src="{{item.logo || 'cloud://cloud1-0gbk9yujb9937f30.636c-cloud1-0gbk9yujb9937f30-1384367427/Waddaeat/icons/canteen.png'}}" mode="aspectFill" lazy-load="true" data-name="{{item.name}}" data-logo="{{item.logo}}" binderror="onBrandLogoError" />
      </view>
      <view class="brand-name">{{item.name}}</view>
    </view>
  </scroll-view>

  <!-- 整体上移容器：包含 banner 与下方所有模块，上移 5rpx -->
  <view class="coupon-content-shift">

  <!-- 平台活动 Banner 轮播 -->
  <view wx:if="{{platformBanners.length}}" class="banner-section">
    <swiper class="banner-swiper" autoplay="true" interval="3500" circular="true">
      <swiper-item wx:for="{{platformBanners}}" wx:key="actId" wx:for-item="b" wx:for-index="bi">
        <view class="banner-slide" data-idx="{{bi}}" bindtap="onTapPlatformBanner" hover-class="none" hover-stop-propagation="true" style="-webkit-tap-highlight-color: transparent;">
          <image class="banner-bg" src="{{b.headUrl}}" mode="aspectFill" binderror="onPlatformBannerImageError" style="-webkit-tap-highlight-color: transparent;" />
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- 分类导航（保留原有结构与样式） -->
  <view class="category-nav">
    <view class="category-item {{selectedCategory==='coupon'?'active':''}}" data-key="coupon" bindtap="onCategoryTap">
      <text class="category-text">红包领券</text>
    </view>
    <view class="category-item {{selectedCategory==='instore'?'active':''}}" data-key="instore" bindtap="onCategoryTap">
      <text class="category-text">到店优惠</text>
    </view>
    <!-- 已移除：限时秒杀入口 -->
  </view>

  <!-- 到店优惠首次加载 Loading -->
  <loading wx:if="{{selectedCategory === 'instore' && instoreLoading}}" show="{{true}}" text="到店优惠加载中..." type="spinner" mask="{{true}}" opacity="{{0.5}}" />

  <!-- 优惠领券区（分页：2x2 网格，每屏4张） -->
  <view class="coupon-section">
    <swiper class="coupon-swiper" current="{{couponSwiperCurrent}}" bindchange="onCouponSwiperChange">
      <swiper-item wx:for="{{couponPages}}" wx:key="pi" wx:for-index="pi" wx:for-item="page">
        <view class="grid">
          <view class="grid-card" wx:for="{{page}}" wx:key="skuViewId" wx:for-item="c" data-id="{{c.skuViewId}}" bindtap="onReceiveCoupon" hover-class="none">
            <!-- 新布局：上方2/3为商品图；下方1/3为信息区 -->
            <image class="card-image" src="{{c.headUrl}}" mode="aspectFill" />
            <view class="card-info">
              <view class="line1">
                <text class="brand">{{c.brandName}}</text>
                <text class="name">{{c.name}}</text>
              </view>
              <view class="line2">
                <view class="prices">
                  <text wx:if="{{c.sellPrice}}" class="price-sale">¥{{c.sellPrice}}</text>
                  <text wx:if="{{c.originalPrice}}" class="price-original">¥{{c.originalPrice}}</text>
                </view>
                <text wx:if="{{c.label1}}" class="tag">{{c.label1}}</text>
              </view>
            </view>
          </view>
        </view>
      </swiper-item>
    </swiper>
    <!-- 自定义导航圆点，位于优惠领券区底部，不与卡片重叠 -->
    <view class="coupon-indicators">
      <block wx:for="{{couponPages}}" wx:key="pi" wx:for-index="pi">
        <view class="indicator-dot {{couponSwiperCurrent === pi ? 'active' : ''}}"></view>
      </block>
    </view>
  </view>

  <!-- 已按需求移除领券中心的附近优惠模块（保留今日选择页的附近优惠不变） -->

  <view class="page-bottom-spacer"></view>

  </view> <!-- /coupon-content-shift -->
</view>